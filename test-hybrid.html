<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fdom Hybrid Function Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 8px 16px; margin: 5px; }
        .active { background-color: #007bff; color: white; }
        .shadow { box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .red-text { color: red; }
    </style>
</head>
<body>
    <h1>fdom Hybrid Function Test</h1>
    <p>This page tests both imperative and curried calling patterns for fdom functions.</p>

    <div class="test-section" id="test-results">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>Test Elements</h2>
        <button id="btn">Test Button</button>
        <div id="container">Container</div>
        <form id="test-form">
            <input type="text" name="username" placeholder="Username">
            <input type="email" name="email" placeholder="Email">
            <input type="checkbox" name="agree" id="agree">
            <label for="agree">I agree</label>
        </form>
    </div>

    <script type="module">
        import * as fdom from './dist/esm/development/index.js';

        const results = document.getElementById('results');
        const btn = document.getElementById('btn');
        const container = document.getElementById('container');
        const form = document.getElementById('test-form');

        function log(message, success = true) {
            const div = document.createElement('div');
            div.className = success ? 'success' : 'error';
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        function testImperative() {
            try {
                // Test cls.add imperative
                fdom.cls.add(btn, 'active', 'shadow');
                log('‚úì cls.add(btn, "active", "shadow") - imperative works');

                // Test modify imperative
                fdom.modify(btn, { text: 'Imperative Test' });
                log('‚úì modify(btn, { text: "Imperative Test" }) - imperative works');

                // Test css imperative
                fdom.css(btn, { color: 'red' });
                log('‚úì css(btn, { color: "red" }) - imperative works');

                // Test append imperative
                fdom.append(container, 'Imperative content');
                log('‚úì append(container, "Imperative content") - imperative works');

                // Test Data.set imperative
                fdom.Data.set(btn, 'test', 'value');
                log('‚úì Data.set(btn, "test", "value") - imperative works');

                // Test Form.populate imperative
                fdom.Form.populate(form, { username: 'testuser', email: 'test@example.com', agree: true });
                log('‚úì Form.populate(form, data) - imperative works');

                return true;
            } catch (e) {
                log('‚úó Imperative tests failed: ' + e.message, false);
                return false;
            }
        }

        function testCurried() {
            try {
                // Test cls.add curried
                fdom.cls.add(btn)('active', 'shadow');
                log('‚úì cls.add(btn)("active", "shadow") - curried works');

                // Test modify curried
                fdom.modify(btn)({ text: 'Curried Test' });
                log('‚úì modify(btn)({ text: "Curried Test" }) - curried works');

                // Test css curried
                fdom.css(btn)({ color: 'blue' });
                log('‚úì css(btn)({ color: "blue" }) - curried works');

                // Test append curried
                fdom.append(container)('Curried content');
                log('‚úì append(container)("Curried content") - curried works');

                // Test Data.set curried
                fdom.Data.set(btn)('test2', 'value2');
                log('‚úì Data.set(btn)("test2", "value2") - curried works');

                // Test Form.populate curried
                fdom.Form.populate(form)({ username: 'currieduser', email: 'curried@example.com' });
                log('‚úì Form.populate(form)(data) - curried works');

                return true;
            } catch (e) {
                log('‚úó Curried tests failed: ' + e.message, false);
                return false;
            }
        }

        function testEventHandlers() {
            try {
                // Test on imperative
                const cleanup1 = fdom.on(btn, 'click', (e, target) => {
                    log('‚úì on(btn, "click", handler) - imperative event works');
                });
                log('‚úì on(btn, "click", handler) - imperative setup works');

                // Test on curried
                const cleanup2 = fdom.on(btn)('click', (e, target) => {
                    log('‚úì on(btn)("click", handler) - curried event works');
                });
                log('‚úì on(btn)("click", handler) - curried setup works');

                // Clean up
                cleanup1();
                cleanup2();

                return true;
            } catch (e) {
                log('‚úó Event handler tests failed: ' + e.message, false);
                return false;
            }
        }

        function testWatchers() {
            try {
                // Test watchClass imperative
                const cleanup1 = fdom.watchClass(btn, 'active', (isPresent) => {
                    log('‚úì watchClass(btn, "active", callback) - imperative watcher works');
                });
                log('‚úì watchClass(btn, "active", callback) - imperative setup works');

                // Test watchClass curried
                const cleanup2 = fdom.watchClass(btn)('active', (isPresent) => {
                    log('‚úì watchClass(btn)("active", callback) - curried watcher works');
                });
                log('‚úì watchClass(btn)("active", callback) - curried setup works');

                // Test watchAttr imperative
                const cleanup3 = fdom.watchAttr(btn, 'data-test', (value) => {
                    log('‚úì watchAttr(btn, "data-test", callback) - imperative works');
                });
                log('‚úì watchAttr(btn, "data-test", callback) - imperative setup works');

                // Clean up
                cleanup1();
                cleanup2();
                cleanup3();

                return true;
            } catch (e) {
                log('‚úó Watcher tests failed: ' + e.message, false);
                return false;
            }
        }

        // Run all tests
        log('Starting fdom hybrid function tests...');

        const imperativeOk = testImperative();
        const curriedOk = testCurried();
        const eventsOk = testEventHandlers();
        const watchersOk = testWatchers();

        if (imperativeOk && curriedOk && eventsOk && watchersOk) {
            log('üéâ All tests passed! Both imperative and curried patterns work correctly.', true);
        } else {
            log('‚ùå Some tests failed. Check the console for details.', false);
        }

        // Test backward compatibility - ensure old curried usage still works
        log('Testing backward compatibility...');
        try {
            fdom.cls.add(btn)('backward-compat');
            fdom.modify(btn)({ text: 'Backward Compatible' });
            log('‚úì Backward compatibility maintained - old curried patterns still work');
        } catch (e) {
            log('‚úó Backward compatibility broken: ' + e.message, false);
        }
    </script>
</body>
</html>